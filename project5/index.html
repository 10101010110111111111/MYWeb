<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Blackjack Simulation - Card Counting & Strategy</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Advanced Blackjack Simulation</h1>
            <div class="controls">
                <div class="control-group">
                    <label>Mode:</label>
                    <select id="gameMode">
                        <option value="simulation">Simulation Mode</option>
                        <option value="player">Player Mode</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Counting System:</label>
                    <select id="countingSystem">
                        <option value="hilo">Hi-Lo</option>
                        <option value="wong">Wong Halves</option>
                        <option value="ko">KO (Knock Out)</option>
                        <option value="hiopt1">Hi-Opt I</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Decks:</label>
                    <select id="deckCount">
                        <option value="6">6 Decks</option>
                        <option value="8" selected>8 Decks</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Betting Strategy:</label>
                    <select id="bettingStrategy">
                        <option value="basic">Basic (1-8 units)</option>
                        <option value="skipping">Skipping (0-4 units)</option>
                        <option value="custom">Custom Betting</option>
                    </select>
                </div>
                <div class="control-group" id="customBettingControls" style="display: none;">
                    <label>Custom Betting Units:</label>
                    <div class="custom-betting-inputs">
                        <div class="bet-input">
                            <label>Count < 1:</label>
                            <input type="number" id="betCount0" value="0" min="0" max="20">
                        </div>
                        <div class="bet-input">
                            <label>Count ≥ 1:</label>
                            <input type="number" id="betCount1" value="1" min="0" max="20">
                        </div>
                        <div class="bet-input">
                            <label>Count ≥ 2:</label>
                            <input type="number" id="betCount2" value="2" min="0" max="20">
                        </div>
                        <div class="bet-input">
                            <label>Count ≥ 3:</label>
                            <input type="number" id="betCount3" value="4" min="0" max="20">
                        </div>
                        <div class="bet-input">
                            <label>Count ≥ 4:</label>
                            <input type="number" id="betCount4" value="8" min="0" max="20">
                        </div>
                    </div>
                </div>
                <div class="control-group" id="speedControl">
                    <label>Speed:</label>
                    <select id="speed">
                        <option value="1">1ms</option>
                        <option value="10">10ms</option>
                        <option value="50" selected>50ms</option>
                        <option value="100">100ms</option>
                        <option value="500">500ms</option>
                    </select>
                </div>
                <button id="startBtn">Start</button>
                <button id="pauseBtn" disabled>Pause</button>
                <button id="resetBtn">Reset</button>
            </div>
        </header>

        <div class="game-section">
            <div class="game-info">
                <div class="count-info">
                    <div class="count-item">
                        <label>Running Count:</label>
                        <span id="runningCount">0</span>
                    </div>
                    <div class="count-item">
                        <label>True Count:</label>
                        <span id="trueCount">0</span>
                    </div>
                    <div class="count-item">
                        <label>Remaining Decks:</label>
                        <span id="remainingDecks">8.0</span>
                    </div>
                    <div class="count-item">
                        <label>Cards Left:</label>
                        <span id="cardsLeft">416</span>
                    </div>
                </div>
                <div class="game-stats">
                    <div class="stat-item">
                        <label>Total Hands:</label>
                        <span id="totalHands">0</span>
                    </div>
                    <div class="stat-item">
                        <label>Current Hand:</label>
                        <span id="currentHand">0</span>
                    </div>
                    <div class="stat-item">
                        <label>Overall Win Rate:</label>
                        <span id="overallWinRate">0%</span>
                    </div>
                    <div class="stat-item">
                        <label>Bankroll:</label>
                        <span id="bankroll">1000 chips</span>
                    </div>
                </div>
            </div>

            <div class="table">
                <div class="dealer-section">
                    <h3>Dealer</h3>
                    <div class="hand" id="dealerHand"></div>
                    <div class="hand-value">Value: <span id="dealerValue">0</span></div>
                </div>

                <div class="player-section">
                    <h3>Player</h3>
                    <div id="playerHands"></div>
                    <div class="bet-info">
                        <label>Current Bet: <span id="currentBet">1 units (100 chips)</span></label>
                    </div>
                </div>

                <!-- Player Control Buttons -->
                <div class="player-controls" id="playerControls" style="display: none;">
                    <button id="hitBtn" class="action-btn">Hit</button>
                    <button id="standBtn" class="action-btn">Stand</button>
                    <button id="doubleBtn" class="action-btn">Double</button>
                    <button id="splitBtn" class="action-btn">Split</button>
                    <button id="insuranceBtn" class="action-btn insurance-btn" style="display: none;">Insurance</button>
                    <button id="declineInsuranceBtn" class="action-btn decline-btn" style="display: none;">Decline Insurance</button>
                    <div class="strategy-hint" id="strategyHint"></div>
                </div>

                <div class="action-log">
                    <h4>Game Log:</h4>
                    <div id="actionLog">Ready to start...</div>
                </div>
            </div>
        </div>

        <div class="statistics-section">
            <h2>True Count Statistics</h2>
            <div class="stats-controls">
                <button id="exportBtn">Export Data</button>
                <button id="showDeviationsBtn">Show Deviations</button>
                <span class="stats-info">Click on a row to see detailed breakdown</span>
            </div>
            <div class="stats-tables">
                <table id="statsTable">
                    <thead>
                        <tr>
                            <th>True Count</th>
                            <th>Games Played</th>
                            <th>Points Earned</th>
                            <th>Success Rate</th>
                            <th>Win %</th>
                            <th>Push %</th>
                            <th>Loss %</th>
                            <th>Blackjacks</th>
                        </tr>
                    </thead>
                    <tbody id="statsBody">
                    </tbody>
                </table>
            </div>
            
            <div id="detailModal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h3 id="modalTitle">True Count Details</h3>
                    <div id="modalContent"></div>
                </div>
            </div>

            <div id="deviationsModal" class="modal">
                <div class="modal-content">
                    <span class="close-deviations">&times;</span>
                    <h3>Illustrious 18 Deviations</h3>
                    <div id="deviationsContent"></div>
                </div>
            </div>
        </div>

        <div class="percentage-simulation-section">
            <h2>Percentage Simulation - The Ultimate Test</h2>
            <div class="percentage-sim-info">
                <p>This is the largest simulation possible. It will run in the background and show <strong>Expected Value (EV)</strong> and <strong>Frequency</strong> for each true count from -5 to +5. EV is the true measure of advantage - it accounts for all payouts including blackjack (1.5:1), push (0), and regular wins (1:1). Frequency shows how often each count occurs.</p>
                <p><strong>Blackjack Rules:</strong> Player blackjack pays 1.5:1, dealer blackjack = immediate loss, both blackjack = push. <strong>Insurance:</strong> Taken when true count ≥ 3 (basic strategy).</p>
                <p><strong>Expected Value:</strong> Shows your true advantage in %. At TC=+1, you should see approximately +0.5% EV (not 50.5% win rate). This is the real metric for blackjack strategy.</p>
            </div>
            <div class="percentage-sim-controls">
                <div class="control-group">
                    <label>Number of Hands to Simulate:</label>
                    <div class="simulation-input-group">
                        <input type="number" id="percentageSimHands" value="1000000" min="100000" max="100000000" step="100000">
                        <div class="quick-options">
                            <button class="quick-option-btn" data-value="100000">100K</button>
                            <button class="quick-option-btn" data-value="1000000">1M</button>
                            <button class="quick-option-btn" data-value="10000000">10M</button>
                            <button class="quick-option-btn" data-value="100000000">100M</button>
                        </div>
                    </div>
                </div>
                <div class="control-group">
                    <label>Strategy:</label>
                    <select id="percentageSimStrategy">
                        <option value="basic">Basic Strategy Only</option>
                        <option value="basic+deviations" selected>Basic Strategy + Deviations</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Counting System:</label>
                    <select id="percentageSimCounting">
                        <option value="hilo" selected>Hi-Lo</option>
                        <option value="wong">Wong Halves</option>
                        <option value="ko">KO (Knock Out)</option>
                        <option value="hiopt1">Hi-Opt I</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Number of Decks:</label>
                    <select id="percentageSimDecks">
                        <option value="1">1 Deck</option>
                        <option value="2">2 Decks</option>
                        <option value="4">4 Decks</option>
                        <option value="6">6 Decks</option>
                        <option value="8" selected>8 Decks</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Shuffle Point:</label>
                    <select id="percentageSimShuffle">
                        <option value="0.25">25% (Early Shuffle)</option>
                        <option value="0.5" selected>50% (Standard)</option>
                        <option value="0.75">75% (Late Shuffle)</option>
                        <option value="0.9">90% (Deep Penetration)</option>
                    </select>
                </div>
                <button id="startPercentageSimBtn">Start Percentage Simulation</button>
                <button id="stopPercentageSimBtn" disabled>Stop Simulation</button>
            </div>
            
            <div class="percentage-progress-section" id="percentageProgressSection" style="display: none;">
                <h3>Simulation Progress</h3>
                <div class="simulation-config">
                    <div class="config-info">
                        <span>Configuration: <strong id="simConfig">8 Decks, 50% Shuffle, Hi-Lo</strong></span>
                    </div>
                </div>
                <div class="progress-info">
                    <div class="progress-stats">
                        <span>Hands Completed: <strong id="percentageHandsCompleted">0</strong></span>
                        <span>Remaining: <strong id="percentageHandsRemaining">0</strong></span>
                        <span>Speed: <strong id="percentageSimSpeed">0</strong> hands/sec</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="percentageProgressFill"></div>
                        </div>
                        <span id="percentageProgressText">0% Complete</span>
                    </div>
                </div>
            </div>
            
            <div class="percentage-results-section" id="percentageResultsSection" style="display: none;">
                <h3>Win Percentage Results by True Count</h3>
                <div class="results-summary-percentage">
                    <div class="summary-stats">
                        <div class="stat-item">
                            <label>Total Hands:</label>
                            <span id="totalPercentageHands">0</span>
                        </div>
                        <div class="stat-item">
                            <label>Overall Win Rate:</label>
                            <span id="overallPercentageWinRate">0.0000%</span>
                        </div>
                        <div class="stat-item">
                            <label>Simulation Time:</label>
                            <span id="percentageSimTime">0s</span>
                        </div>
                    </div>
                </div>
                <div class="percentage-results-table">
                    <table id="percentageResultsTable">
                        <thead>
                            <tr>
                                <th>True Count</th>
                                <th>Hands Played</th>
                                <th>Frequency</th>
                                <th>Expected Value</th>
                                <th>Win Rate</th>
                                <th>Wins</th>
                                <th>Losses</th>
                                <th>Pushes</th>
                                <th>Blackjacks</th>
                            </tr>
                        </thead>
                        <tbody id="percentageResultsBody">
                        </tbody>
                    </table>
                </div>
                <div class="expand-results-section">
                    <button id="expandAllResultsBtn" class="expand-btn">Show All Counts (-10 to +10)</button>
                    <div id="expandedResults" style="display: none;">
                        <h4>Extended Results (All Counts)</h4>
                        <table id="expandedResultsTable">
                            <thead>
                                <tr>
                                    <th>True Count</th>
                                    <th>Hands Played</th>
                                    <th>Frequency</th>
                                    <th>Expected Value</th>
                                    <th>Win Rate</th>
                                    <th>Wins</th>
                                    <th>Losses</th>
                                    <th>Pushes</th>
                                    <th>Blackjacks</th>
                                </tr>
                            </thead>
                            <tbody id="expandedResultsBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="multi-simulation-section">
            <h2>Multi-Simulation Analysis</h2>
            <div class="current-betting-info">
                <span>Current Betting Mode: <strong id="currentBettingMode">Basic</strong></span>
            </div>
            <div class="multi-sim-controls">
                <div class="control-group">
                    <label>Number of Simulations:</label>
                    <select id="numSimulations">
                        <option value="10">10 Simulations</option>
                        <option value="25">25 Simulations</option>
                        <option value="50">50 Simulations</option>
                        <option value="100">100 Simulations</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Hands per Simulation:</label>
                    <select id="handsPerSim">
                        <option value="500">500 Hands</option>
                        <option value="1000">1,000 Hands</option>
                        <option value="2500">2,500 Hands</option>
                        <option value="5000">5,000 Hands</option>
                        <option value="10000" selected>10,000 Hands</option>
                        <option value="25000">25,000 Hands</option>
                        <option value="50000">50,000 Hands</option>
                        <option value="100000">100,000 Hands</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Strategy Comparison:</label>
                    <select id="strategyComparison">
                        <option value="single">Single Strategy</option>
                        <option value="counting-systems">Compare Counting Systems</option>
                        <option value="betting-strategies">Compare Betting Strategies</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Quick Betting Mode:</label>
                    <div class="betting-mode-buttons">
                        <button id="basicBettingBtn" class="betting-mode-btn active">Basic</button>
                        <button id="skippingBettingBtn" class="betting-mode-btn">Skipping</button>
                        <button id="customBettingBtn" class="betting-mode-btn">Custom</button>
                    </div>
                </div>
                <button id="startMultiSimBtn">Start Multi-Simulation</button>
                <button id="stopMultiSimBtn" disabled>Stop All</button>
            </div>
            
            <div class="progress-section" id="progressSection" style="display: none;">
                <h3>Simulation Progress</h3>
                <div class="overall-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="overallProgress"></div>
                    </div>
                    <span id="progressText">0% Complete</span>
                </div>
                <div class="strategy-progress" id="strategyProgress"></div>
            </div>
            
            <div class="results-section" id="resultsSection" style="display: none;">
                <h3>Simulation Results</h3>
                <div class="results-summary" id="resultsSummary"></div>
                <div class="detailed-results" id="detailedResults"></div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="multi-simulation.js"></script>
    <script src="percentage-simulation.js"></script>
</body>
</html>
